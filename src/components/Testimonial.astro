---
const testimonials = [
  {
    quote: "The rooftop bar offers breathtaking views of the city skyline. Perfect for unwinding after exploring the city. Staff was incredibly attentive.",
    name: "Sarah Mitchell",
    location: "New York, USA",
    rating: 5,
  },
  {
    quote: "Exceptional service from check-in to checkout. The spa treatments were divine and the concierge helped us discover hidden gems in the city.",
    name: "James Chen",
    location: "London, UK",
    rating: 5,
  },
  {
    quote: "A truly luxurious experience. The room was immaculate with stunning city views. Will definitely return on our next business trip.",
    name: "Maria Santos",
    location: "SÃ£o Paulo, Brazil",
    rating: 5,
  },
  {
    quote: "The modern amenities combined with classic elegance made our stay unforgettable. The concierge service exceeded all expectations.",
    name: "Emma Thompson",
    location: "Paris, France",
    rating: 5,
    },
    {
    quote: "Outstanding location in the heart of the city. The rooms are spacious and the breakfast buffet was incredible. Highly recommended!",
    name: "Michael Rodriguez",
    location: "Madrid, Spain",
    rating: 5,
    },
    {
    quote: "Stayed here for a special anniversary celebration. The staff arranged everything perfectly, and the sunset view from our room was magical.",
    name: "Lisa Wang",
    location: "Singapore",
    rating: 5,
    },
    {
    quote: "Impeccable cleanliness and attention to detail throughout. The gym facilities are top-notch and the wellness center is a true sanctuary.",
    name: "David Kowalski",
    location: "Berlin, Germany",
    rating: 5,
    },
    {
    quote: "The rooftop infinity pool overlooking the city is absolutely stunning. Perfect blend of comfort, style, and world-class service.",
    name: "Isabella Rossi",
    location: "Milan, Italy",
    rating: 5,
    },
    {
    quote: "Best hotel experience of my travels. The staff remembered our preferences and the personalized service made us feel like VIPs.",
    name: "Robert Hamilton",
    location: "Toronto, Canada",
    rating: 5,
    }
];

const cardsPerPage = 3;
const testimonialPages = Array.from(
  { length: Math.ceil(testimonials.length / cardsPerPage) },
  (_, index) => testimonials.slice(index * cardsPerPage, index * cardsPerPage + cardsPerPage)
);
---

<section class="py-20 bg-light-gray">
  <div class="container mx-auto px-4 md:px-15">
    <!-- Header -->
    <div class="flex flex-col items-center gap-4 mb-12">
      <span class="font-body text-sm font-medium text-gold-warm tracking-[3px]">
        GUEST EXPERIENCES
      </span>
      <h2 class="font-headline text-3xl md:text-[42px] font-medium text-text-primary">
        What Our Guests Say
      </h2>
      <div class="w-15 h-0.75 bg-sky-blue"></div>
    </div>

    <!-- Carousel Area -->
    <div class="flex items-center justify-center gap-8">
      <!-- Left Arrow -->
      <button
        type="button"
        class="hidden md:flex items-center justify-center w-12 h-12 rounded-full bg-white border border-border-gray hover:bg-light-gray transition-colors"
        id="testimonial-prev"
        aria-label="Previous testimonial"
      >
        <svg class="w-6 h-6 text-text-primary" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
      </button>

      <!-- Cards Container -->
      <div class="overflow-hidden w-full max-w-250" id="testimonial-viewport" style="touch-action: pan-y;">
        <div class="flex transition-transform duration-500 ease-out gap-2 lg:gap-6 px-2 lg:px-6 py-4" id="testimonial-track">
          {testimonialPages.map((page) => (
            <div class="w-full shrink-0 grid grid-cols-1 md:grid-cols-3 gap-2 lg:gap-6">
              {page.map((testimonial) => (
                <div class="bg-white rounded-lg p-4 lg:p-8 shadow-[0_4px_20px_rgba(0,0,0,0.06)] flex flex-col items-center gap-5 h-full">
                  <!-- Quote Icon -->
                  <svg class="w-8 h-8 text-gold-warm" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z" />
                  </svg>

                  <!-- Quote Text -->
                  <p class="font-body text-sm text-text-primary text-center leading-[1.7]">
                    "{testimonial.quote}"
                  </p>

                  <!-- Stars -->
                  <div class="flex gap-1">
                    {Array.from({ length: testimonial.rating }).map(() => (
                      <svg class="w-4 h-4 text-gold-warm" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                      </svg>
                    ))}
                  </div>

                  <!-- Author -->
                  <div class="flex flex-col items-center gap-1">
                    <span class="font-headline text-base font-medium text-text-primary">
                      {testimonial.name}
                    </span>
                    <span class="font-body text-xs text-medium-gray">
                      {testimonial.location}
                    </span>
                  </div>
                </div>
              ))}
            </div>
          ))}
        </div>
      </div>

      <!-- Right Arrow -->
      <button
        type="button"
        class="hidden md:flex items-center justify-center w-12 h-12 rounded-full bg-sky-blue hover:bg-sky-blue-light transition-colors"
        id="testimonial-next"
        aria-label="Next testimonial"
      >
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>

    <!-- Pagination Dots -->
    <div class="flex items-center justify-center gap-3 mt-12" id="testimonial-dots">
      {testimonialPages.map((_, index) => (
        <button
          type="button"
          class:list={[
            'rounded-full transition-all',
            index === 0 ? 'w-3 h-3 bg-sky-blue' : 'w-2 h-2 bg-border-gray',
          ]}
          data-index={index}
          aria-label={`Go to testimonial page ${index + 1}`}
        />
      ))}
    </div>
  </div>
</section>

<script>
  const viewport = document.getElementById('testimonial-viewport');
  const track = document.getElementById('testimonial-track');
  const prevBtn = document.getElementById('testimonial-prev');
  const nextBtn = document.getElementById('testimonial-next');
  const dots = document.querySelectorAll('#testimonial-dots button');
  const pages = track?.querySelectorAll(':scope > div') as NodeListOf<HTMLElement>;

  let currentPage = 0;
  const totalPages = dots.length;
  let touchStartX = 0;
  const swipeThreshold = 50;

  function updateDots() {
    dots.forEach((dot, index) => {
      if (index === currentPage) {
        dot.classList.remove('w-2', 'h-2', 'bg-border-gray');
        dot.classList.add('w-3', 'h-3', 'bg-sky-blue');
      } else {
        dot.classList.remove('w-3', 'h-3', 'bg-sky-blue');
        dot.classList.add('w-2', 'h-2', 'bg-border-gray');
      }
    });
  }

  function updateCarousel() {
    if (!track || !pages?.length) return;
    const pageOffset = pages[currentPage]?.offsetLeft || 0;
    track.style.transform = `translateX(-${pageOffset}px)`;
    updateDots();
  }

  function triggerBounce(direction: 'left' | 'right') {
    if (!viewport) return;

    const bounceClass = direction === 'left' ? 'carousel-bounce-left' : 'carousel-bounce-right';
    viewport.classList.remove('carousel-bounce-left', 'carousel-bounce-right');
    void viewport.offsetWidth;
    viewport.classList.add(bounceClass);
    window.setTimeout(() => viewport.classList.remove(bounceClass), 350);
  }

  function goPrevPage() {
    if (currentPage === 0) {
      triggerBounce('left');
      return;
    }

    currentPage -= 1;
    updateCarousel();
  }

  function goNextPage() {
    if (currentPage === totalPages - 1) {
      triggerBounce('right');
      return;
    }

    currentPage += 1;
    updateCarousel();
  }

  prevBtn?.addEventListener('click', () => {
    goPrevPage();
  });

  nextBtn?.addEventListener('click', () => {
    goNextPage();
  });

  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      currentPage = index;
      updateCarousel();
    });
  });

  viewport?.addEventListener(
    'touchstart',
    (event) => {
      touchStartX = event.changedTouches[0]?.clientX || 0;
    },
    { passive: true }
  );

  viewport?.addEventListener(
    'touchend',
    (event) => {
      const touchEndX = event.changedTouches[0]?.clientX || 0;
      const deltaX = touchStartX - touchEndX;

      if (Math.abs(deltaX) < swipeThreshold) return;

      if (deltaX > 0) {
        goNextPage();
      } else {
        goPrevPage();
      }
    },
    { passive: true }
  );

  window.addEventListener('resize', updateCarousel);
</script>

<style is:global>
  @keyframes testimonial-bounce-left {
    0%,
    100% {
      transform: translateX(0);
    }
    35% {
      transform: translateX(-10px);
    }
    65% {
      transform: translateX(4px);
    }
  }

  @keyframes testimonial-bounce-right {
    0%,
    100% {
      transform: translateX(0);
    }
    35% {
      transform: translateX(10px);
    }
    65% {
      transform: translateX(-4px);
    }
  }

  .carousel-bounce-left {
    animation: testimonial-bounce-left 0.35s ease-out;
  }

  .carousel-bounce-right {
    animation: testimonial-bounce-right 0.35s ease-out;
  }
</style>
